<!DOCTYPE html>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Multinomial Reduction</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript">
(function() {
  document.write('<link rel="stylesheet" href="katex/katex.min.css" />');
})();(function() {document.write('<scr' + 'ipt type="text/javascript" src="katex/katex.min.js"></scr' + 'ipt>');})();(function(f) {
  // A "simple" onLoad function
  if (window.document.readyState == "complete") {
    f();
  } else if (window.document.addEventListener) {
    window.document.addEventListener("DOMContentLoaded", f, false);
  } else if (window.attachEvent) {
    window.attachEvent("onreadystatechange", function() {
      if (window.document.readyState == "complete") {
        f();
      }
    });
  } else {
    var oldLoad = window.onload;
    if (typeof(oldLoad) == "function") {
      window.onload = function() {
        try {
          oldLoad();
        } finally {
          f();
        }
      };
    } else {
      window.onload = f;
    }
  }
})(function() {
  // This is an ugly way to change the doctype, in case the scribble document
  // did not use (with-html5).
  if (!(document.doctype && document.doctype.publicId == '')) {
    if (console && console.log) {
      console.log("Re-wrote the document to use the HTML5 doctype.\n"
                  + "  Consider using the following declaration:\n"
                  + "      @title[#:style (with-html5 manual-doc-style)]{â€¦}");
    }
    var wholeDoc = '<!doctype HTML>\n' + document.documentElement.outerHTML;
    document.open();
    document.clear();
    document.write(wholeDoc);
  }
  var inlineElements = document.getElementsByClassName("texMathInline");
  for (var i = 0; i < inlineElements.length; i++) {
    var e = inlineElements[i];
    katex.render(e.textContent, e, { displayMode:false, throwOnError:false });
  }
  var displayElements = document.getElementsByClassName("texMathDisplay");
  for (var i = 0; i < displayElements.length; i++) {
    var e = displayElements[i];
    katex.render(e.textContent, e, { displayMode:true, throwOnError:false });
  }
});
</script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Multinomial Reduction</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Polynomials_as_.Labeled_.Ordered_.Trees%29" class="tocviewlink" data-pltdoc="x">Polynomials as Labeled Ordered Trees</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Polynomials_as_.Unlabeled_.Unordered_.Trees%29" class="tocviewlink" data-pltdoc="x">Polynomials as Unlabeled Unordered Trees</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Sparse_.Multinomials_as_.Unlabeled_.Unordered_.Trees%29" class="tocviewlink" data-pltdoc="x">Sparse Multinomials as Unlabeled Unordered Trees</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Acknowledgements%29" class="tocviewlink" data-pltdoc="x">Acknowledgements</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Multinomial_.Reduction%29" class="tocsubseclink" data-pltdoc="x">Multinomial Reduction</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cmain~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;main&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Polynomials_as_.Labeled_.Ordered_.Trees%29" class="tocsubseclink" data-pltdoc="x">Polynomials as Labeled Ordered Trees</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Polynomials_as_.Unlabeled_.Unordered_.Trees%29" class="tocsubseclink" data-pltdoc="x">Polynomials as Unlabeled Unordered Trees</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3csetup-types~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;setup-types&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cadd~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;add&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cmult~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;mult&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Sparse_.Multinomials_as_.Unlabeled_.Unordered_.Trees%29" class="tocsubseclink" data-pltdoc="x">Sparse Multinomials as Unlabeled Unordered Trees</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Acknowledgements%29" class="tocsubseclink" data-pltdoc="x">Acknowledgements</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cimports~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;imports&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cprovide~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;provide&gt;</a></span></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">7.8</span></div><h2><a name="(part._.Multinomial_.Reduction)"></a>Multinomial Reduction</h2><p><div class="SIntrapara"><a name="(elem._(chunk._~3cmain~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cmain~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;main&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><a href="#%28elem._%28chunk._~3cimports~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;imports&gt;</a><span class="hspace">&nbsp;</span><a href="#%28elem._%28chunk._~3csetup-types~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;setup-types&gt;</a><span class="hspace">&nbsp;</span><a href="#%28elem._%28chunk._~3cadd~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;add&gt;</a><span class="hspace">&nbsp;</span><a href="#%28elem._%28chunk._~3cmult~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;mult&gt;</a><span class="hspace">&nbsp;</span><a href="#%28elem._%28chunk._~3cprovide~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;provide&gt;</a></p></blockquote></div></p><p>We want to take a multinomial such as <span class="texMathInline">(xy+1)*(xy+1)</span>, and reduce it to <span class="texMathInline">1 + 2xy + x^2y^2</span>. Notice that the result is in the order you might expect &ndash; constants before powers, increasing powers, etc.</p><h3>1<tt>&nbsp;</tt><a name="(part._.Polynomials_as_.Labeled_.Ordered_.Trees)"></a>Polynomials as Labeled Ordered Trees</h3><p>For simplicity we will start with polynomials and work up to multinomials.
Our first thought may be to implement them as labeled ordered trees. For example, we could have <span class="texMathInline">xy+1</span> represented as the tree</p><p><img style="vertical-align: -3.7939453125px; margin: -3px -3px -3px -3px;" src="pict.png" alt="image" width="56.0" height="116.0"/></p><p>or in racket <span class="RktPn">(</span><span class="RktSym">+</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">*</span><span class="stt"> </span><span class="RktVal">"x"</span><span class="stt"> </span><span class="RktVal">"y"</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span>. The issue is that this tree is equivalent to all of the following trees:</p><p><img style="vertical-align: -3.7939453125px; margin: -3px -3px -3px -3px;" src="pict_2.png" alt="image" width="236.0" height="116.0"/></p><p>This duplication stems from commutativity of addition and multiplication. If we had picked binary trees, we would additionally suffer from duplication due to associativity of addition and multiplication.</p><p>In choosing a representation that is not isomorphic to the original structure, we will be forced to add extra boilerplate that increases our code&rsquo;s complexity, in both senses of the word.</p><h3>2<tt>&nbsp;</tt><a name="(part._.Polynomials_as_.Unlabeled_.Unordered_.Trees)"></a>Polynomials as Unlabeled Unordered Trees</h3><p>We want to remove labels from the trees. But in order to do so we need to adopt a convention for the meanings of items at different depths.
Let&rsquo;s first consider some example polynomials:</p><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_3.png" alt="image" width="694.0" height="106.80078125"/></p><p>Well technically these trees are still labeled, but it is in a more uniform way.
At the top level of the tree, &#8613; acts like 1 and &#8615; acts like -1, and repetition acts like addition.</p><p>At the lower level of the tree, &#8613; acts like the variable <span class="texMathInline">x</span> and &#8615; acts like <span class="texMathInline">x^{-1}</span>, and repetition acts like multiplication.
Internally, we can represent these unordered trees as multisets. Here are the same trees in the same order, written as multisets.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3csetup-types~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3csetup-types~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;setup-types&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-singleton-type</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-wrapper-type</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">&#8613;</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-wrapper-type</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">&#8615;</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">two</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">neg-two</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">two</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">two</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">two</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">two</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">two</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">two</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">neg-two</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">neg-two</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">neg-two</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Before moving on to multisets, let&rsquo;s implement addition and multiplication.
Addition is just gluing trees together.</p><p><span class="texMathDisplay">2 + 3 \rightarrow 5</span></p><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_4.png" alt="image" width="306.0" height="53.400390625"/></p><p><span class="texMathDisplay">3x^2 + 3x^2 \rightarrow 6x^2</span></p><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_5.png" alt="image" width="670.0" height="84.80078125"/></p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cadd~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cadd~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;add&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">msets</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">fold</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset-add-all</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">empty-multiset</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">msets</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>Multiplication will be a bit more complicated. Remember the top level of the trees represents addition and the lower level represents multiplication. So we should expect all pairs of top level arrows to interact, and the lower level arrows should add. Here are some examples:</p><p><span class="texMathDisplay">3x^2 * 2 \rightarrow 6x^2</span></p><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_6.png" alt="image" width="560.0" height="84.80078125"/></p><p><span class="texMathDisplay">3x^2 * x \rightarrow 3x^3</span></p><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_7.png" alt="image" width="462.0" height="84.80078125"/></p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cmult~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cmult~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;mult&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mult</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">msets</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mult-aux</span><span class="hspace">&nbsp;</span><span class="RktSym">level</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">match</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8402;?</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8402;?</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mult-aux</span><span class="hspace">&nbsp;</span><span class="RktSym">level</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mult-aux</span><span class="hspace">&nbsp;</span><span class="RktSym">level</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mult-aux</span><span class="hspace">&nbsp;</span><span class="RktSym">level</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mult-aux</span><span class="hspace">&nbsp;</span><span class="RktSym">level</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">m1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">multiset?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">m2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eq?</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktSym">level</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">for*/multiset</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">m1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">m2</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mult-aux</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add</span><span class="hspace">&nbsp;</span><span class="RktSym">m1</span><span class="hspace">&nbsp;</span><span class="RktSym">m2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">fold</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">curry</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">mult-aux</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="hspace">&nbsp;</span><span class="RktSym">msets</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>Ok, this is all fine, but I thought this article was supposed to about multinomial reduction. What if I told you that if we represent multinomials in the right way, then we have already implemented multinomial reduction? Sparse multinomial reduction, at that?</p><h3>3<tt>&nbsp;</tt><a name="(part._.Sparse_.Multinomials_as_.Unlabeled_.Unordered_.Trees)"></a>Sparse Multinomials as Unlabeled Unordered Trees</h3><p>In each level we represent one kind of object in unary. At the top level we represent coefficients in unary. Then we represent exponents in unary. For multinomials, we will want to create trees that are one level deeper. What is it that we can now represent in unary that is necessary to specify a term in a multinomial?</p><p>We would rather have numbers in our tree than have variables or strings anyway, so let&rsquo;s have n represent the nth variable, denoted <span class="texMathInline">x_n</span>.</p><p>Let&rsquo;s look at an example.</p><p><span class="texMathDisplay">x_2x_1^3+2x_3</span></p><blockquote class="SCentered"><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_8.png" alt="image" width="276.0" height="116.201171875"/></p></blockquote><p>The shape of the tree corresponds to <span class="texMathInline">x_2x_1^3 + x_3 + x_3</span>, from left to right. Remember that the top level is addition &ndash; there are as many top level branches as the sum of multinomial coefficients (3). The next level corresponds to exponents &ndash; we see groupings of size 1, 3, 1, and 1, corresponding to the powers of <span class="texMathInline">x_2^1</span>, <span class="texMathInline">x_1^3</span>, <span class="texMathInline">x_3^1</span>, and <span class="texMathInline">x_3^1</span>, respectively. At the bottom layer, we have identification of variable names. One child means <span class="texMathInline">x_1</span>, two means <span class="texMathInline">x_2</span>, and three means <span class="texMathInline">x_3</span>.</p><p><span class="texMathDisplay">x_2x_0^3+2x_3</span></p><blockquote class="SCentered"><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_9.png" alt="image" width="276.0" height="116.201171875"/></p></blockquote><p>Zero children at the last level corresponds to our 0th variable, or <span class="texMathInline">x_0</span>.</p><p>Now let&rsquo;s show our original example, translated to use variable indices:
<span class="texMathDisplay">xy+1 \approx x_0x_1+1</span></p><blockquote class="SCentered"><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_10.png" alt="image" width="68.0" height="116.201171875"/></p></blockquote><p><span class="texMathDisplay">(x_0x_1+1)+(x_0x_1+1) \rightarrow 2x_0x_1+2</span></p><blockquote class="SCentered"><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_11.png" alt="image" width="358.0" height="116.201171875"/></p></blockquote><p><span class="texMathDisplay">(x_0x_1+1)*(x_0x_1+1) \rightarrow x_0^2x_1^2+2x_0x_1+1</span></p><blockquote class="SCentered"><p><img style="vertical-align: -2.80078125px; margin: -3px -3px -3px -3px;" src="pict_12.png" alt="image" width="430.0" height="116.201171875"/></p></blockquote><p>The top level consists of coefficients which need to be multiplied, and the next level consists of exponents which needs to be added. What changes about variable indices during multiplication? Absolutely nothing. This is why the pre-existing multiplication operation will work out of the box.</p><p>Not including imports, we have implemented a sparse multinomial reduction engine in 18 lines of code!</p><h3>4<tt>&nbsp;</tt><a name="(part._.Acknowledgements)"></a>Acknowledgements</h3><p>All material to do with representation of integers and polynomials comes from Norman Wildberger. My contribution is an implementation and extension to the multinomial case.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cimports~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cimports~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;imports&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">except-in</span><span class="hspace">&nbsp;</span><span class="RktSym">srfi/1</span><span class="hspace">&nbsp;</span><span class="RktSym">span</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">racket/match</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">only-in</span><span class="hspace">&nbsp;</span><span class="RktSym">racket/function</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">curry</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">rebellion/collection/list</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">rebellion/collection/multiset</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">rebellion/collection/hash</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">rebellion/streaming/transducer</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">rebellion/type/wrapper</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">rebellion/type/enum</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">rebellion/base/option</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">rebellion/type/singleton</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cprovide~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cprovide~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;provide&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">provide</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8402;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8613;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8615;</span><span class="hspace">&nbsp;</span><span class="RktSym">add</span><span class="hspace">&nbsp;</span><span class="RktSym">mult</span><span class="RktPn">)</span></p></blockquote></div></p></div></div><div id="contextindicator">&nbsp;</div></body></html>